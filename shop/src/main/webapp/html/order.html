<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">

		<title>订单管理</title>

		<link href="../AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css">
		<link href="../AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet" type="text/css">

		<link href="../css/personal.css" rel="stylesheet" type="text/css">
		<link href="../css/orstyle.css" rel="stylesheet" type="text/css">

		<script src="../AmazeUI-2.4.2/assets/js/jquery.min.js"></script>
		<script src="../AmazeUI-2.4.2/assets/js/amazeui.js"></script>

	</head>

	<body>

		<div class="center">
			<div class="col-main">
				<div class="main-wrap">

					<div class="user-order">

						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">订单管理</strong> / <small>Order</small></div>
						</div>
						<hr/>

						<div class="am-tabs am-tabs-d2 am-margin" data-am-tabs>

							<ul class="am-avg-sm-5 am-tabs-nav am-nav am-nav-tabs">
								<li class="am-active"><a href="#tab1">所有订单</a></li>
								<li><a href="#tab2" id="#change">待付款</a></li>
							</ul>

							<div class="am-tabs-bd">
								<div class="am-tab-panel am-fade am-in am-active" id="tab1">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="all">
										</div>

									</div>

								</div>
								<div class="am-tab-panel am-fade" id="tab2" >

									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="wait">
										</div>

									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>

<script>

	function getData() {
		$.ajax({
			url: "/findOrder?type=all",
			type: "GET",
			success: function (data) {
//			console.log(data);
				let str = "";
				for (let i = 0; i < data.count; i++) {
					var it = data.order[i];
					str += "<div class='order-status5'><div class='order-title'><div class='dd-num'>订单编号：<a href='javascript:'>" + it.order_id + "</a></div><span>成交时间：" + it.time + "</span><em style='margin-left: 50px'>店铺：" + it.shop_name + "</em></div><div class='order-content'><div class='order-left'>"
					for (let j = 0; j < it.count; j++) {
						str += "<ul class='item-list'><li class='td td-item'><div class='item-pic'><a href='#' class='J_MakePoint'><img src='../images/kouhong.jpg_80x80.jpg' class='itempic J_ItemImg'></a></div><div class='item-info'><div class='item-basic-info'><a href='#'><p>" + it.commodity[j].name + "</p></a></div></div></li><li class='td td-price'><div class='item-price'>" + it.commodity[j].price / it.commodity[j].count + "</div></li><li class='td td-number'><div class='item-number'><span>×</span>" + it.commodity[j].count + "</div></li><li class='td td-operation'><a href='suggest.html?id="+it.order_id+"'>评价</a><div class='item-operation'></div></li></ul>"
					}
					str += "</div><div class='order-right'><li class='td td-amount'><div class='item-amount'>合计：" + it.order_price + "元</div></li><div class='move-right'><li class='td td-status'><div class='item-status'><p class='Mystatus'>" + it.order_status + "</p></div></li><li class='td td-change'><div class='am-btn am-btn-danger anniu' onclick='delOrder(" + it.order_id + ")'>删除订单</div></li></div></div></div></div>"
				}
				document.getElementById("all").innerHTML = str;
			},
			error: function () {
				console.log("error");
			}
		})
	}

	getData();

	function getDate1() {
		$.ajax({
			url: "/findOrder?type=wait",
			type: "GET",
			success: function (data) {
//			console.log(data);
				let str = "";
				for (let i = 0; i < data.count; i++) {
					var it = data.order[i];
					str += "<div class='order-status5'><div class='order-title'><div class='dd-num'>订单编号：<a href='javascript:'>" + it.order_id + "</a></div><span>成交时间：" + it.time + "</span><em style='margin-left: 50px'>店铺：" + it.shop_name + "</em></div><div class='order-content'><div class='order-left'>"
					for (let j = 0; j < it.count; j++) {
						str += "<ul class='item-list'><li class='td td-item'><div class='item-pic'><a href='#' class='J_MakePoint'><img src='../images/kouhong.jpg_80x80.jpg' class='itempic J_ItemImg'></a></div><div class='item-info'><div class='item-basic-info'><a href='#'><p>" + it.commodity[j].name + "</p></a></div></div></li><li class='td td-price'><div class='item-price'>" + it.commodity[j].price / it.commodity[j].count + "</div></li><li class='td td-number'><div class='item-number'><span>×</span>" + it.commodity[j].count + "</div></li><li class='td td-operation'><div class='item-operation'></div></li></ul>"
					}
					str += "</div><div class='order-right'><li class='td td-amount'><div class='item-amount'>合计：" + it.order_price + "元</div></li><div class='move-right'><li class='td td-status'><div class='item-status'><p class='Mystatus'>" + it.order_status + "</p><p class='order-info'><a onclick='changeOrder("+it.order_id+")'>取消订单</a></p></div></li><li class='td td-change'><a href='pay.html'><div class='am-btn am-btn-danger anniu'>一键支付</div></a></li></div></div></div></div>"
				}
				document.getElementById("wait").innerHTML = str;
			},
			error: function () {
				console.log("error");
			}
		})
	}

	getDate1();

	function delOrder(data) {
		const flag = confirm("您确认要删除吗？");
		if(flag) {
			$.ajax({
				url: "/delOrderByOrderId",
				type: "post",
				data: "orderId=" + data,
				async: false,
				success: function (data) {
					getData();
					getDate1();
				},
				error: function () {
				}
			})
		}
	}

	function changeOrder(data) {
		const flag = confirm("您确认要取消订单吗？");
		if(flag) {
			$.ajax({
				url: "/updateOrder",
				type: "post",
				data: "status="+2+"&orderId=" + data,
				async: false,
				success: function (data) {
					getData();
					getDate1();
				},
				error: function () {
				}
			})
		}
	}

</script>